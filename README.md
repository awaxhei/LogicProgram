# 数独生成器 (Sudoku Generator)

一个基于Flask和Z3求解器的Web数独生成器，支持多种阶数的数独生成和验证。

## 功能特性

- **多阶数支持**: 支持4x4、9x9、16x16阶数的数独
- **唯一解验证**: 确保生成的数独题目有且只有一个解
- **智能缓存**: 预生成数独缓存，提高响应速度
- **美观界面**: 响应式设计，支持主题定制
- **实时验证**: 用户填写后可实时验证答案正确性
- **刷新功能**: 支持刷新当前数独重新生成

## 技术栈

- **后端**: Flask (Python Web框架)
- **求解器**: Z3 Theorem Prover (数独生成核心)
- **前端**: HTML5 + CSS3 + JavaScript
- **缓存**: 多线程缓存机制

## 安装与运行

### 环境要求

- Python 3.7+
- pip (Python包管理器)

### 安装步骤

1. 克隆或下载项目文件
2. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```

3. 运行应用：
   ```bash
   python app.py
   ```

4. 打开浏览器访问：`http://localhost:5000`

### 项目结构

```
LogicProgram/
├── app.py              # Flask主应用
├── config.py           # 前端配置
├── test.py             # 数独生成器
├── requirements.txt    # 依赖包列表
├── static/             # 静态资源
│   └── images/         # 图片资源
└── templates/          # 模板文件
    └── index.html      # 主页面
```

## 使用方法

1. **选择阶数**: 在输入框中输入数独阶数（必须是完全平方数，如4、9、16）
2. **生成数独**: 点击"生成数独"按钮
3. **填写答案**: 在空白格子中填写数字
4. **验证答案**: 点击"验证答案"检查填写是否正确
5. **刷新题目**: 点击"刷新"按钮重新生成数独

## 配置说明

项目支持前端界面自定义配置，可在 `config.py` 中修改：

- **背景图片**: 支持自定义背景和遮罩效果
- **颜色主题**: 可自定义主色调、辅助色等
- **动画效果**: 支持单元格动画和消息动画
- **消息提示**: 可配置提示位置和显示时长

## 数独生成算法

使用Z3约束求解器生成数独，算法特点：

1. **约束求解**: 使用数独规则作为约束条件
2. **唯一解验证**: 确保生成的题目有且只有一个解
3. **随机挖空**: 随机移除约60%的数字生成题目
4. **递归重试**: 遇到无解或不唯一情况自动重试

## 缓存机制

- **预生成缓存**: 服务器启动时预生成各阶数独
- **动态补充**: 缓存不足时后台自动生成补充
- **线程安全**: 使用锁机制确保多线程安全
- **容量控制**: 每个阶数最多缓存3个数独

## API接口

### 生成数独
- **路径**: `/` (POST)
- **参数**: `n` - 数独阶数
- **返回**: 数独题目和解

### 刷新数独
- **路径**: `/refresh` (POST)
- **参数**: `n`, `puzzle`, `solution`
- **功能**: 将当前数独重新放回缓存

### AI提示
- **路径**: `/hint` (POST)
- **参数**: `n`, `current_state`
- **功能**: 获取AI解题提示
- **返回**: AI生成的解题建议

## 故障排除

### 常见问题

1. **无法生成数独**
   - 检查Z3求解器是否正确安装
   - 确认输入的阶数是完全平方数

2. **缓存初始化失败**
   - 检查Python版本兼容性
   - 确认系统资源充足

3. **界面显示异常**
   - 清除浏览器缓存
   - 检查静态资源路径

### 日志查看

应用运行时会输出详细的日志信息，包括：
- 缓存初始化状态
- 数独生成过程
- 错误和异常信息

## 开发说明

### 扩展新功能

要添加新的数独阶数，修改 `app.py` 中的 `SUPPORTED_SIZES` 列表：

```python
SUPPORTED_SIZES = [4, 9, 16, 25]  # 添加25阶支持
```

### 自定义样式

修改 `config.py` 中的 `FRONTEND_CONFIG` 来定制界面样式。

## AI提示功能

### 功能说明
- **智能提示**: 基于AI的解题建议，帮助用户解决数独难题
- **实时分析**: 根据当前数独状态提供针对性建议
- **可配置**: API、密钥和提示词均可自定义配置

### 安全配置方法

为了保护您的API密钥安全，请按照以下步骤配置：

1. **使用配置文件模板**：
   ```bash
   # 复制配置文件模板
   cp config_template.py config.py
   ```

2. **编辑配置文件**：
   在 `config.py` 中修改 `AI_CONFIG` 配置项，填入您的真实API密钥：

   ```python
   AI_CONFIG = {
       'enabled': True,  # 启用AI提示功能
       'api_url': 'https://api.deepseek.com/v1/chat/completions',  # AI API地址
       'api_key': 'your-actual-api-key-here',  # 替换为你的真实API密钥
       'model': 'deepseek-chat',  # 使用的模型
       'prompt_template': '请为这个数独提供一些解题提示：\n数独阶数：{n}\n当前状态：{current_state}\n请给出简洁的第一人称以建议的口吻的一句话的解题思路和下一步建议。',
       'max_tokens': 200
   }
   ```

3. **安全保护**：
   - `config.py` 文件已被添加到 `.gitignore`，不会被推送到Git仓库
   - 只有 `config_template.py` 模板文件会被版本控制
   - 确保不要将包含真实密钥的配置文件提交到版本控制

### 项目结构更新
```
LogicProgram/
├── app.py              # Flask主应用
├── config_template.py  # 配置文件模板（安全）
├── config.py           # 实际配置文件（本地，不提交）
├── .gitignore          # Git忽略规则
├── requirements.txt    # 依赖包列表
├── static/             # 静态资源
└── templates/          # 模板文件
```

### 使用方法
1. 生成数独后，点击"提示"按钮
2. 系统将发送当前数独状态给AI接口
3. 等待AI返回解题建议
4. 查看提示结果并应用于解题

### 支持的AI服务
- OpenAI GPT系列 (默认)
- 其他兼容OpenAI API格式的服务

### 注意事项
- 需要有效的API密钥才能使用AI提示功能
- API调用可能产生费用，请关注使用量
- 网络连接质量影响提示响应速度
- 建议在遇到困难时使用提示功能

## 许可证

本项目仅供学习和研究使用。

## 贡献

欢迎提交Issue和Pull Request来改进项目。

---

**注意**: 数独生成依赖于Z3求解器，请确保正确安装相关依赖包。AI提示功能需要配置有效的API密钥。


